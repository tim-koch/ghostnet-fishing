<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <meta charset="UTF-8">
    <title>Geisternetz melden</title>
</head>
<body>
<header>
    <h1>Ghost Net Fishing</h1>
</header>

<main>

<h2>Neues Geisternetz melden</h2>

<nav>
    <a th:href="@{/}">Startseite</a>
    <a th:href="@{/ghostnets}">Alle Geisternetze</a>
    <a th:href="@{/ghostnets/open}">Offene Geisternetze</a>
    <a th:href="@{/ghostnets/new}">Neues Geisternetz melden</a>
</nav>


<form th:action="@{/ghostnets}" th:object="${form}" method="post">

    <div>
        <label for="latitude">Breitengrad (Latitude, Bereich -90 bis +90):</label>
        <input id="latitude" type="number" step="0.000001"
               min="-90" max="90"
               th:field="*{latitude}" required>
        <span th:if="${#fields.hasErrors('latitude')}"
              th:errors="*{latitude}"></span>
    </div>

    <div>
        <label for="longitude">Längengrad (Longitude, Bereich -180 bis +180):</label>
        <input id="longitude" type="number" step="0.000001"
               min="-180" max="180"
               th:field="*{longitude}" required>
        <span th:if="${#fields.hasErrors('longitude')}"
              th:errors="*{longitude}"></span>
    </div>

    <div>
        <button type="button" onclick="useCurrentLocation()">Aktuelle Position übernehmen</button>
        <button type="button" onclick="openInMap()">Koordinaten in Karte öffnen</button>
    </div>

    <hr>

    <div>
        <label for="sizeEstimate">Größenabschätzung:</label>
        <input id="sizeEstimate" type="text" th:field="*{sizeEstimate}" required>
        <span th:if="${#fields.hasErrors('sizeEstimate')}"
              th:errors="*{sizeEstimate}"></span>
    </div>

    <div>
        <label>
            <input type="checkbox" th:field="*{anonymous}">
            Anonym melden
        </label>
    </div>

    <div>
        <label for="reporterName">Name (falls nicht anonym):</label>
        <input id="reporterName" type="text" th:field="*{reporterName}">
        <span th:if="${#fields.hasErrors('reporterName')}"
              th:errors="*{reporterName}"></span>
    </div>

    <div>
        <label for="phoneNumber">Telefonnummer (optional):</label>
        <input id="phoneNumber" type="text" th:field="*{phoneNumber}">
    </div>

    <div>
        <button type="submit">Geisternetz speichern</button>
        <a th:href="@{/ghostnets}">Zurück zur Übersicht</a>
    </div>

</form>

<script>
    function useCurrentLocation() {
        if (!navigator.geolocation) {
            alert("Geolocation wird von diesem Browser nicht unterstützt.");
            return;
        }

        navigator.geolocation.getCurrentPosition(function (position) {
            var latInput = document.getElementById("latitude");
            var lonInput = document.getElementById("longitude");

            latInput.value = position.coords.latitude.toFixed(6);
            lonInput.value = position.coords.longitude.toFixed(6);
        }, function (error) {
            alert("Position konnte nicht ermittelt werden: " + error.message);
        });
    }

    function openInMap() {
        var lat = document.getElementById("latitude").value;
        var lon = document.getElementById("longitude").value;

        if (!lat || !lon) {
            alert("Bitte zuerst Latitude und Longitude ausfüllen.");
            return;
        }

        var url = "https://www.openstreetmap.org/?mlat=" + encodeURIComponent(lat) +
            "&mlon=" + encodeURIComponent(lon) +
            "#map=13/" + encodeURIComponent(lat) + "/" + encodeURIComponent(lon);

        window.open(url, "_blank");
    }
</script>

</body>
</html>
